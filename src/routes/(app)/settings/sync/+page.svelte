<script lang="ts">
    import {_} from 'svelte-i18n';
    import {accountsDb, db} from "$lib/db";
    import {liveQuery} from "dexie";

    function loginStart() {
        db.cloud.login();
    }

    function loginStart2() {
        accountsDb.cloud.login();
    }

    async function logout() {
        await db.table('$logins').clear();
    }

    $: user = liveQuery(async () => {
        const user = await db.table('$logins')
                .filter((u) => u.isLoggedIn)
                .first()
        return user;
    })
</script>

<svelte:head>
  <title>{$_('settings_about')} - TOKIMEKI</title>
</svelte:head>

<div>
  <div class="column-heading">
    <div class="column-heading__buttons">
      <button class="settings-back" on:click={() => {history.back()}}>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--text-color-1)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
      </button>
    </div>

    <h1 class="column-heading__title">{$_('settings_sync')}</h1>

    <div class="column-heading__buttons column-heading__buttons--right">
      <a class="settings-back" href="/">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--text-color-1)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
      </a>
    </div>
  </div>

  <div class="settings-wrap">
    {#if ($user)}
      {#if ($user.isLoggedIn)}
        <p class="sync-status">{$_('sync_logged_in')}: {$user.email}</p>
        <button class="button button--border" on:click={logout}>{$_('logout_button')}</button>
      {/if}
    {:else}
      <p class="sync-status">{$_('sync_not_logged_in')}</p>
      <button class="button" on:click={loginStart}>{$_('login')}</button>
    {/if}
  </div>
</div>

<style lang="postcss">
    .sync-status {
        margin-bottom: 16px;
    }
</style>